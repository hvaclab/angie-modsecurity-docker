# Документация angie-modsecurity-docker

Добро пожаловать в документацию angie-modsecurity-docker. Эта документация описывает, как интегрированный стек безопасности работает в связке для обеспечения комплексной защиты ваших веб-приложений.

## Что такое angie-modsecurity-docker?

angie-modsecurity-docker — это готовый к production Docker-стек веб-сервера, который объединяет несколько компонентов безопасности и производительности в единую систему. Это не просто набор инструментов, а тщательно выстроенная интеграция, где каждый компонент усиливает другие.

## Ключевые точки интеграции

Этот стек состоит из четырех основных компонентов, которые работают вместе:

1. **Angie** — высокопроизводительный веб-сервер с интеграцией ModSecurity
2. **ModSecurity** — Web Application Firewall (WAF), встроенный в Angie
3. **Fail2Ban** — система банов по IP на основе анализа логов Angie
4. **Vector** — пайплайн обогащения логов, добавляющий интеллект к исходным данным
5. **OAuth2-Proxy** — слой аутентификации для интеграции с Keycloak

## Обзор архитектуры

```
                                  Интернет
                                     |
                                     v
                        +------------------------+
                        |   Angie (Port 80/443)  |
                        |  - Rate Limiting       |
                        |  - ModSecurity WAF     |
                        |  - GeoIP Enrichment    |
                        |  - SSL/TLS (HTTP/3)    |
                        +------------------------+
                                     |
                    +----------------+----------------+
                    |                                 |
                    v                                 v
           +-----------------+              +------------------+
           | OAuth2-Proxy    |              | Backend Apps     |
           | (Keycloak auth) |              | (Proxied)        |
           +-----------------+              +------------------+
                    |
                    v
           +------------------+
           | Logs Directory   |
           | /var/log/angie/  |
           +------------------+
                    |
        +-----------+------------+
        |                        |
        v                        v
   +----------+            +-----------+
   | Fail2Ban |            | Vector    |
   | (Читает) |            | (Обогащает)|
   +----------+            +-----------+
        |                        |
        v                        v
   [IP баны]              [Обогащенные логи]
```

## Структура документации

### Основные концепции

- **[Архитектура](architecture.md)** — как компоненты связаны и взаимодействуют
- **[Путь запроса](request-flow.md)** — путешествие запроса через все слои защиты
- **[Слои безопасности](security-layers.md)** — стратегия глубокоэшелонированной защиты

### Конфигурация и эксплуатация

- **[Руководство по конфигурации](configuration.md)** — как настроить интегрированный стек
- **[Система логирования](logging.md)** — многоуровневое обогащение и обработка логов
- **[Устранение неполадок](troubleshooting.md)** — отладка проблем в интегрированной системе

## Быстрый старт

1. **Изучите архитектуру** — прочитайте [Архитектура](architecture.md) для понимания связей компонентов
2. **Проследите запрос** — см. [Путь запроса](request-flow.md) для понимания обработки данных
3. **Настройте стек** — используйте [Руководство по конфигурации](configuration.md) для настройки
4. **Мониторинг и отладка** — изучите [Логирование](logging.md) и [Устранение неполадок](troubleshooting.md)

## Ключевые возможности

### Многоуровневая безопасность

- **Уровень 1 (Angie)**: Rate limiting, гео-блокировка, валидация заголовков
- **Уровень 2 (ModSecurity)**: правила WAF, OWASP CRS, обнаружение SQL-инъекций
- **Уровень 3 (Fail2Ban)**: баны IP на основе паттернов в агрегированных логах
- **Уровень 4 (OAuth2-Proxy)**: аутентификация и авторизация для защищенных ресурсов

См. [Слои безопасности](security-layers.md) для детального описания взаимодействия.

### Интеллектуальное логирование

- **Уровень 1 (Angie)**: обогащение логов GeoIP, анализ User-Agent, флаги безопасности
- **Уровень 2 (Vector)**: продвинутая обработка, подсчет security score, классификация угроз

См. [Система логирования](logging.md) для полного описания пайплайна.

### Оптимизации производительности

- **HTTP/3 (QUIC)** для более быстрых соединений
- **Brotli/Zstd** сжатие для снижения трафика
- **Rate limiting** для предотвращения исчерпания ресурсов
- **Кэширование** на нескольких уровнях

## Философия интеграции

В отличие от автономных развертываний, этот стек построен на следующих принципах:

1. **Поток данных** — каждый компонент обогащает данные для следующего уровня
2. **Общее состояние** — директория логов является коммуникационным хабом
3. **Глубокоэшелонированная защита** — множественные уровни ловят разные типы атак
4. **Прогрессивное улучшение** — каждый уровень добавляет интеллект без блокировки предыдущих

## В чем отличие?

Большинство руководств показывают, как настроить Angie, ModSecurity или Fail2Ban по отдельности. Эта документация фокусируется на:

- Как Angie передает запросы в ModSecurity
- Как логи ModSecurity читаются Fail2Ban
- Как Vector обогащает логи дополнительным контекстом
- Как OAuth2-Proxy интегрируется с системой аутентификации Angie
- Как отлаживать проблемы, затрагивающие несколько компонентов

## Получение помощи

Если возникли проблемы:

1. Проверьте [Устранение неполадок](troubleshooting.md) для типичных проблем интеграции
2. Изучите [Путь запроса](request-flow.md) для понимания, где возникает проблема
3. Просмотрите [Систему логирования](logging.md) для поиска релевантных записей
4. Обратитесь к [Архитектуре](architecture.md) для понимания связей компонентов

## Следующие шаги

- Новым пользователям: начните с [Архитектура](architecture.md)
- Настройка стека: переходите к [Руководство по конфигурации](configuration.md)
- Отладка проблем: см. [Устранение неполадок](troubleshooting.md)
- Понимание безопасности: читайте [Слои безопасности](security-layers.md)
