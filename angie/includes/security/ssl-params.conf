# ==============================================================================
# SSL/TLS Configuration - Modern & Secure
# ==============================================================================
# Based on Mozilla SSL Configuration Generator (Modern profile)
# https://ssl-config.mozilla.org/
# ==============================================================================

# --------------------------------------------------------------------------
# Protocol versions - ONLY TLS 1.2 and TLS 1.3
# --------------------------------------------------------------------------
# TLS 1.0 and TLS 1.1 are DISABLED (deprecated, vulnerable to BEAST, POODLE)
ssl_protocols TLSv1.2 TLSv1.3;

# --------------------------------------------------------------------------
# Cipher suites - Modern, secure ciphers only
# --------------------------------------------------------------------------
# TLS 1.3 ciphers (automatic, cannot be configured)
# TLS 1.2 ciphers - ECDHE only, no RSA key exchange, AEAD ciphers
ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305;

# Let client choose cipher (modern clients prefer better ciphers)
ssl_prefer_server_ciphers off;

# --------------------------------------------------------------------------
# DH Parameters - 2048 bit minimum
# --------------------------------------------------------------------------
# Generate with: openssl dhparam -out dhparam.pem 4096
ssl_dhparam /etc/angie/ssl/dhparam.pem;

# ECDH curve
ssl_ecdh_curve X25519:prime256v1:secp384r1;

# --------------------------------------------------------------------------
# Session settings
# --------------------------------------------------------------------------
ssl_session_timeout 1d;
ssl_session_cache shared:SSL:10m;
ssl_session_tickets off;

# --------------------------------------------------------------------------
# OCSP Stapling (enable when using real certificates)
# --------------------------------------------------------------------------
# ssl_stapling on;
# ssl_stapling_verify on;
# resolver 8.8.8.8 8.8.4.4 valid=300s;
# resolver_timeout 5s;

# --------------------------------------------------------------------------
# Security Headers
# --------------------------------------------------------------------------
# HSTS - Force HTTPS for 2 years
add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;

# Prevent clickjacking
add_header X-Frame-Options SAMEORIGIN always;

# Prevent MIME type sniffing
add_header X-Content-Type-Options nosniff always;

# XSS Protection (legacy browsers)
add_header X-XSS-Protection "1; mode=block" always;

# Referrer Policy
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Permissions Policy (formerly Feature-Policy)
add_header Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()" always;
