# ==============================================================================
# Keycloak Protected Paths Configuration
# ==============================================================================
# Список путей, защищённых аутентификацией Keycloak
#
# Файл: /etc/angie/keycloak-protected-paths.conf
# Использование: include /etc/angie/keycloak-protected-paths.conf; (в server блоке)
#
# ВАЖНО: Перед использованием убедитесь что:
#        1. Подключен keycloak-auth.conf
#        2. Запущен oauth2-proxy контейнер
# ==============================================================================

# ------------------------------------------------------------------------------
# Примеры защищённых путей (раскомментируйте и измените по необходимости)
# ------------------------------------------------------------------------------

# --- Защита /admin ---
# location /admin {
#     auth_request /oauth2/auth;
#     error_page 401 = @oauth2_signin;
#
#     # Заголовки с информацией о пользователе
#     auth_request_set $user $upstream_http_x_auth_request_user;
#     auth_request_set $email $upstream_http_x_auth_request_email;
#     auth_request_set $groups $upstream_http_x_auth_request_groups;
#
#     # Передать upstream (если проксируется)
#     # proxy_set_header X-User $user;
#     # proxy_set_header X-Email $email;
#     # proxy_set_header X-Groups $groups;
#
#     # Для статических файлов:
#     alias /var/www/html/admin;
#     index index.html;
#     try_files $uri $uri/ /admin/index.html;
# }

# --- Защита /api/private ---
# location /api/private {
#     auth_request /oauth2/auth;
#     error_page 401 = @oauth2_signin;
#
#     auth_request_set $user $upstream_http_x_auth_request_user;
#     auth_request_set $email $upstream_http_x_auth_request_email;
#
#     proxy_pass http://backend:8080;
#     proxy_set_header X-User $user;
#     proxy_set_header X-Email $email;
# }

# --- Защита /dashboard ---
# location /dashboard {
#     auth_request /oauth2/auth;
#     error_page 401 = @oauth2_signin;
#
#     auth_request_set $user $upstream_http_x_auth_request_user;
#     auth_request_set $email $upstream_http_x_auth_request_email;
#
#     alias /var/www/html/dashboard;
#     index index.html;
#     try_files $uri $uri/ /dashboard/index.html;
# }

# --- Защита /reports ---
# location /reports {
#     auth_request /oauth2/auth;
#     error_page 401 = @oauth2_signin;
#
#     auth_request_set $user $upstream_http_x_auth_request_user;
#     auth_request_set $email $upstream_http_x_auth_request_email;
#
#     alias /var/www/html/reports;
#     autoindex on;
# }

# ==============================================================================
# АКТИВНЫЕ ЗАЩИЩЁННЫЕ ПУТИ
# ==============================================================================
# Добавляйте ваши location блоки ниже этой линии

# Защита папки protected-path (пример)
location /protected-path {
    auth_request /oauth2/auth;
    error_page 401 = @oauth2_signin;

    auth_request_set $user $upstream_http_x_auth_request_user;
    auth_request_set $email $upstream_http_x_auth_request_email;

    alias /var/www/html/protected-path;
    index index.html;
    try_files $uri $uri/ =404;
}

# ==============================================================================
